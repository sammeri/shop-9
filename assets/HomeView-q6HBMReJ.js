import{s as V}from"./v-lazy-image-CtUXuA8b.js";import{s as N,d as q,r as v,_ as D,c as g,F as x,a as w,o as c,n as k,u as b,b as p,e as $,t as L,f as F,g as f,h as I,w as S,v as A,i as O,j as B}from"./index-CLWnTIfX.js";import{_ as j}from"./ProductItemCard-CjB-pwTm.js";import"./index-CjkaUewl.js";import"./index--n7A1ueL.js";import"./index-Db-2WoUS.js";import"./index-BIzU9q55.js";import"./index-GbqiOl8L.js";function J(){return N({url:"/categories",method:"get"})}function U(l){return N({url:`/categories?name=${l}`,method:"get"})}const z=q("categories",()=>{const l=v(!0),a=v([]),n=v({}),s=v(!1);return{pending:l,isCategory:s,allCategories:a,getAllCategories:async()=>{l.value=!0;try{return a.value=await J(),a.value.unshift({name:"все",slug:"all"}),s.value=a.value.length>0,a.value}catch(t){throw console.log(t),new Error(t)}finally{l.value=!1}},getCategoryByName:async t=>{l.value=!0;try{return n.value=await U(t),n.value}catch(d){throw console.log(d),new Error(d)}finally{l.value=!1}}}}),H={class:"menuList flex items-center"},M=["onClick"],Q={class:"menuList__name"},G={key:0,class:"menuList__subcategories flex gap-2"},K={__name:"CategoryTabs",props:{items:{type:Array,required:!0}},emits:["onCategoryClick"],setup(l,{emit:a}){const n=a;let s=v("all"),m=v("");const _=(t,d)=>{const e=d.target.innerText.toLowerCase();if(t.name===e&&s.value!==t.slug&&(s.value=t.slug,m.value="",n("onCategoryClick",t)),s.value!=="all"&&t.subcategories?.find(r=>r.name===e)){const r=t.subcategories.find(C=>{if(C.name===e)return C.slug});m.value=e,s.value=t.slug,n("onCategoryClick",r)}};return(t,d)=>(c(),g("ul",H,[(c(!0),g(x,null,w(l.items,e=>(c(),g("li",{key:e,onClick:r=>_(e,r),class:k(["menuList__item",[{menuList__item_active:b(s)===e.slug,menuList__item_sub:e.subcategories&&e.subcategories.length>0}]])},[p("span",Q,L(e.name.toUpperCase()),1),b(s)===e.slug&&e.subcategories?(c(),g("ul",G,[(c(!0),g(x,null,w(e.subcategories,r=>(c(),g("li",{key:r,class:k(["menuList__subcategory",{menuList__subcategory_active:b(m)===r.name}])},L(r.name.toUpperCase()),3))),128))])):$("",!0)],10,M))),128))]))}},R=D(K,[["__scopeId","data-v-6313ba56"]]),W={class:"container flex min-h-full flex-col items-center"},X={style:{height:"6px"}},Y={class:"my-3 flex w-full justify-between"},Z={class:"mb-4 grid w-full grid-cols-2 gap-6 sm:grid-cols-3 lg:grid-cols-4 2xl:grid-cols-5"},ce={__name:"HomeView",setup(l){const a=v("all"),n=F(),s=z(),m=f(()=>n.pending),_=f(()=>n.products),t=f(()=>s.allCategories),d=f(()=>n.isProducts),e=f(()=>s.isCategory),r=f(()=>a.value==="all"?_.value:_.value.filter(o=>o.category===a.value||o.subcategory===a.value)),{getData:C}=n,{getAllCategories:T}=s,E=o=>{a.value=o.slug};return I(async()=>{try{await T(),await C();const o=localStorage.getItem("favorites"),y=localStorage.getItem("cart");if(o||y){if(o)try{const i=JSON.parse(o);_.value.forEach(u=>{u.isFavorite=!!i.find(h=>h.id===u.id)})}catch(i){console.error("Ошибка парсинга избранных товаров(favorites):",i)}try{const i=JSON.parse(y);_.value.forEach(u=>{const h=i.find(P=>P.id===u.id);h&&(u.quantity=h.quantity)})}catch(i){console.error("Ошибка парсинга товаров корзины(cart):",i)}}}catch(o){console.error("Ошибка загрузки данных:",o)}}),(o,y)=>{const i=V;return c(),g("div",W,[S(p("div",X,null,512),[[A,!m.value]]),S(O(i,{class:"w-screen",mode:"indeterminate",style:{height:"6px"}},null,512),[[A,m.value]]),p("div",Y,[y[0]||(y[0]=p("h1",{class:"text-2xl font-bold sm:text-3xl md:text-4xl"},"Каталог",-1)),d.value&&e.value?(c(),B(R,{key:0,items:t.value,onOnCategoryClick:E},null,8,["items"])):$("",!0)]),p("div",Z,[(c(!0),g(x,null,w(r.value,u=>(c(),B(j,{key:u.id,item:u},null,8,["item"]))),128))])])}}};export{ce as default};
